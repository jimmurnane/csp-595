<!DOCTYPE project>
<project name="csp-595" default="clean-compile-deploy" basedir="../">
	<property environment="env" />

	<target name="clean-compile-deploy" depends="clean, compile, deploy" />
	<target name="clean-compile-unit-test" depends="clean, compile, unit-test" />

	<echo>Java Home - ${env.JAVA_HOME}</echo>
	<echo>Ant Home - ${env.ANT_HOME}</echo>
	<echo>Tomcat Home - </echo>

	<target name="debug">
		<echoproperties />
	</target>

	<target name="testing">
	</target>

	<target name="clean">
		<delete dir="bin" />
		<delete dir="reports" />
	</target>

	<target name="deploy">
		<delete dir="${env.TOMCAT_HOME}/webapps/${ant.project.name}" />
		<copy todir="${env.TOMCAT_HOME}/webapps/${ant.project.name}">
			<fileset dir="bin/${ant.project.name}">
				<include name="**/*.*" />
			</fileset>
		</copy>
	</target>

	<target name="compile">
		<fail message="Tomcat home is not set.">
			<condition>
				<not>
					<isset property="env.TOMCAT_HOME" />
				</not>
			</condition>
		</fail>

		<fail message="Java home is not set.">
			<condition>
				<not>
					<isset property="env.JAVA_HOME" />
				</not>
			</condition>
		</fail>

		<fail message="Ant home is not set.">
			<condition>
				<not>
					<isset property="env.ANT_HOME" />
				</not>
			</condition>
		</fail>

		<mkdir dir="bin/${ant.project.name}/WEB-INF/classes" />
		<javac srcdir="src" destdir="bin/${ant.project.name}/WEB-INF/classes">
			<classpath>
				<fileset dir="${env.TOMCAT_HOME}\lib\">
					<include name="servlet-api.jar" />
					<include name="jsp-api.jar" />
					<include name="el-api.jar" />
					<include name="commons-beanutils-1.8.3.jar" />
				</fileset>
			</classpath>
		</javac>

		<copy todir="bin/${ant.project.name}/WEB-INF/classes">
			<fileset dir="src">
				<include name="**/*.java" />
			</fileset>
		</copy>

		<copy todir="bin/${ant.project.name}/">
			<fileset dir="WebContent">
				<include name="**/*.*" />
			</fileset>
		</copy>

	</target>

	<target name="unit-test">

		<mkdir dir="reports\test" />

		<junit printsummary="yes" haltonfailure="yes">
			<classpath>
				<fileset dir="test\lib">
					<include name="*.jar" />
				</fileset>
			</classpath>

			<formatter type="plain" />
			<formatter type="xml" />

			<batchtest fork="yes" todir="reports\test">
				<fileset dir="test\src">
					<include name="**/*Test*.java" />
				</fileset>
			</batchtest>
		</junit>
	</target>

	<!-- DOES NOT WORK YET -->
	<!--
	<path id="catalina-ant-classpath">
		<fileset dir="${env.TOMCAT_HOME}\bin">
			<include name="tomcat-juli.jar" />
		</fileset>
		<fileset dir="${env.TOMCAT_HOME}\lib">
			<include name="catalina-ant.jar" />
			<include name="tomcat-coyote.jar" />
			<include name="tomcat-util.jar" />
		</fileset>
	</path>

	<property name="url" value="http://localhost:80/manager" />
	<property name="username" value="tomcat" />
	<property name="password" value="tomcat" />

	<taskdef name="deploy" classname="org.apache.catalina.ant.DeployTask" classpathref="catalina-ant-classpath" />
	<taskdef name="list" classname="org.apache.catalina.ant.ListTask" classpathref="catalina-ant-classpath" />
	<taskdef name="reload" classname="org.apache.catalina.ant.ReloadTask" classpathref="catalina-ant-classpath" />
	<taskdef name="resources" classname="org.apache.catalina.ant.ResourcesTask" classpathref="catalina-ant-classpath" />
	<taskdef name="start" classname="org.apache.catalina.ant.StartTask" classpathref="catalina-ant-classpath" />
	<taskdef name="stop" classname="org.apache.catalina.ant.StopTask" classpathref="catalina-ant-classpath" />
	<taskdef name="undeploy" classname="org.apache.catalina.ant.UndeployTask" classpathref="catalina-ant-classpath" />

	<target name="tomcat-restart">
		<antcall target="tomcat-stop" />
		<antcall target="tomcat-start" />
	</target>

	<target name="tomcat-start">
		<java classname="org.apache.catalina.startup.Bootstrap" fork="true">
			<classpath path="${env.TOMCAT_HOME}/bin/bootstrap.jar:${env.TOMCAT_HOME}/bin/tomcat-juli.jar" />
			<jvmarg value="-Dcatalina.home=${env.TOMCAT_HOME}" />
		</java>
	</target>

	<target name="tomcat-stop">
		<java classname="org.apache.catalina.startup.Bootstrap" fork="true">
			<classpath path="${env.TOMCAT_HOME}/bin/bootstrap.jar:${env.TOMCAT_HOME}/bin/tomcat-juli.jar" />
			<jvmarg value="-Dcatalina.home=${env.TOMCAT_HOME}" />
			<arg line="stop" />
		</java>
	</target>

	<target name="start" description="Start Tomcat application">
		<start path='/${ant.project.name}' url="${url}" username="${username}" password="${password}" />
	</target>
	<target name="stop" description="Stop Tomcat application">
		<stop path="/${ant.project.name}" url="${url}" username="${username}" password="${password}" />
	</target>
	-->
</project>
